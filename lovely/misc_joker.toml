[manifest]
version = "1.0.0"
dump_lua = true
priority = -1

# LeBaron James - Calculate Steel effects when played
[[patches]]
[patches.pattern]
target = "functions/common_events.lua"
pattern = "if context.cardarea == G.hand and context.main_scoring then"
position = "at"
payload = "if (context.cardarea == G.hand or context.cardarea == G.play and next(SMODS.find_card('j_cry_lebaron_james')) and Cryptid.safe_get(SMODS.Ranks,Cryptid.safe_get(card,'base','value') or 'm','key') == 'King') and context.main_scoring then"
match_indent = true

[[patches]]
[patches.pattern]
target = "functions/common_events.lua"
pattern = "ret.playing_card = {}"
position = "at"
payload = "ret.playing_card = ret.playing_card or {}"
match_indent = true

[[patches]]
[patches.pattern]
target = '''=[SMODS _ "src/overrides.lua"]'''
pattern = '''
    local tuples = {}
    local ret = {}
'''
position = "before"
payload = "local stones = Cryptid.get_paved_joker()"
match_indent = true

[[patches]]
[patches.pattern]
target = '''=[SMODS _ "src/overrides.lua"]'''
pattern = '''
if next(ranks[l]) then
'''
position = "at"
payload = "if next(ranks[l]) or stones > 0 then"
match_indent = true

[[patches]]
[patches.pattern]
target = '''=[SMODS _ "src/overrides.lua"]'''
pattern = '''
if i > min_length and not any_tuple then
'''
position = "at"
payload = "if i > min_length and not any_tuple or stones > 0 then"
match_indent = true

[[patches]]
[patches.pattern]
target = '''=[SMODS _ "src/overrides.lua"]'''
pattern = '''
tuples = new_tuples
'''
position = "after"
payload = '''
stones = stones - 1
'''
match_indent = true